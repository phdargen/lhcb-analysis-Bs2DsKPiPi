% !TEX root = main.tex
\section{Acceptance}
\label{sec:Acceptance}

\subsection{MC corrections}

\subsubsection{Truth matching of simulated candidates}

We use the \textsf{BackgroundCategory} tool to truth match our simulated candidates. 
Candidates with background category (\textsf{BKGCAT}) 20 or 50 are considered to be true signal. 
Background category 60 is more peculiar since it contains both badly reconstructed
signal candidates and ghost background.
This is due to the fact that the classification algorithms identifies all tracks 
for which less than $70\%$ of the reconstructed hits are matched to generated truth-level quantities as ghosts.
In particular for signal decays involving many tracks (as in our case),
this arbitrary cutoff is not $100\%$ efficient.
Moreover, the efficiency is expected to depend on the kinematics which would lead to a biased acceptance determination
if candidates with \textsf{BKGCAT}$=60$ would be removed. \\
We therefore include \textsf{BKGCAT}$=60$ and statistically subtract the ghost background by using the \textsf{sPlot} technique.
The \textsf{sWeights} are calculated from a fit to the reconstructed $B_s$ mass.  
The signal contribution is modeled as described in Sec.~\ref{subsec:signalmodel} and the background with a polynomial.
The fit is performed simultaneously in two categories; the first includes events with \textsf{BKGCAT} = 20 or 50 and
the second events with \textsf{BKGCAT}  = 60.
To account for the different mass resolution we use a different $\sigma$ for each category,
while the mean and the tail parameters are shared between them. 
The background component is only included for the second category.
\\
A significant fraction of $8\%$ of the true signal candidates are classified as ghosts,
while only $x.x \%$ of the events classified with \textsf{BKGCAT}$=60$ are indeed genuine ghosts.


%We repeat the efficiency determination with an alternative fit model to assign a systematic uncertainty.


\begin{figure}[h]
\centering
\includegraphics[height=!,width=0.4\textwidth]{figs/MassFit/signalMC_pull.pdf}
\includegraphics[height=!,width=0.4\textwidth]{figs/MassFit/signalMC_ghost_pull.pdf}

\includegraphics[height=!,width=0.4\textwidth]{figs/MassFit/normMC_pull.pdf}
\includegraphics[height=!,width=0.4\textwidth]{figs/MassFit/normMC_ghost_pull.pdf}

\caption{The reconstructed $B_s$ mass distribution for simulated $B_s \to D_s K \pi \pi$ (top) and $B_s \to D_s \pi \pi \pi$ (bottom) decays 
classified with \textsf{BKGCAT} = 20 or 50 (left) and \textsf{BKGCAT} = 60 (right) after the full selection. }
\label{fig:}
\end{figure}

\clearpage
\subsubsection{PID efficiencies}

\begin{figure}[h]
\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/PID_Ds2KKpi_1_K_plus_PIDK.pdf}
\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/PID_Ds2KKpi_1_pi_plus_PIDK.pdf}
\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/PID_Ds2KKpi_1_pi_minus_PIDK.pdf}

\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/PID_Ds2KKpi_1_K_plus_fromDs_PIDK.pdf}
\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/PID_Ds2KKpi_1_K_minus_fromDs_PIDK.pdf}
\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/PID_Ds2KKpi_1_pi_minus_fromDs_PIDK.pdf}
\caption{}
\label{fig:}
\end{figure}

\begin{figure}[h]
\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/eff_PID_Ds2KKpi_1_Bs_DTF_TAU.pdf}
\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/eff_PID_Ds2KKpi_1_m_Kpipi.pdf}
\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/eff_PID_Ds2KKpi_1_m_Dspipi.pdf}

\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/eff_PID_Ds2KKpi_1_m_Kpi.pdf}
\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/eff_PID_Ds2KKpi_1_m_pipi.pdf}
\includegraphics[height=!,width=0.32\textwidth]{figs/dataVsMC/signal_pid/eff_PID_Ds2KKpi_1_m_Dspi.pdf}
\caption{}
\label{fig:}
\end{figure}


\subsubsection{BDT efficiencies}


\subsubsection{Tracking efficiencies}


\clearpage

\subsection{Decay-time acceptance}
\label{sec:timeAcceptance}
The decay-time distribution of the $\Bs$ mesons is sculpted due to the geometry of the LHCb detector and the applied selection cuts, which are described in Section \ref{sec:Selection}.
In particular, any requirement on the flight distance (FD), the impact parameter (IP) or the direction angle (DIRA) of the $\Bs$ mesons, as well as the direct cut on the lifetime, will lead to a decay-time dependent efficiency $a(t)$. This efficiency will distort the theoretically expected, time-dependent decay rate

\begin{equation}
\frac{\Gamma(t)^{observed}}{dt} = \frac{\Gamma(t)^{theory}}{dt} \cdot a(t),
\label{eq:DecRateAcc}
\end{equation} 

and has to be modelled correctly, in order to describe the observed decay rate. We use our control channel for this measurement, because for $\Bs\to\Ds\kaon\pion\pion$ decays the decay-time acceptance is correlated with the CP-observables which we aim to measure. Therefore, floating the CP-observables and the acceptance shape at the same time is not possible. 
Hence, a fit to the decay-time distribution of $\Bs\to\Ds\pion\pion\pion$ candidates is performed and the obtained acceptance shape is corrected by the difference in shape found for the $\Bs\to\Ds\kaon\pion\pion$ and $\Bs\to\Ds\pion\pion\pion$ MC. \newline
A PDF of the form

\begin{equation}
\mathcal{P}(t^{'},\vec{\lambda}) = \left[ (e^{\Gamma_{s}t}\cdot cosh(\frac{\Delta\Gamma_{s}t}{2}) \times \mathcal{R}(t - t^{'})\right] \cdot \epsilon(t^{'}, \vec{\lambda}),
\label{eq:AccPDF}
\end{equation}

is fit to the decay time distribution of $\Bs\to\Ds\pion\pion\pion$ candidates in data. 
Since the fit is performed untagged, the PDF shown in Eq. \ref{eq:AccPDF} contains no terms proportional to $\dms$. 
The values for $\Gamma_{s}$ and $\Delta\Gamma_{s}$ are fixed to the latest HFAG results \cite{HFAG}. 
The decay-time acceptance $\epsilon(t^{'}, \vec{\lambda})$ is modelled using the sum of cubic polynomials $v_{i}(t)$, so called Splines \cite{Karbach:2014qba}. 
The polynomials are parametrised by so-called knots which determine their boundaries. Knots can be set across the fitted distribution to account for local changes in the acceptance shape.
Using more knots is equivalent to using more base splines which are defined on a smaller sub-range. 
In total, $n+2$ base splines $v_{i}(t)$ are needed to describe an acceptance shape which is parametrised using $n$ knots.\newline
For fits shown in the following, the knots have been placed at $t = [0.5, 1.0, 1.5, 2.0, 3.0, 9.5] ps$. To accommodate these 6 knot positions, 8 basic splines $v_{i}$, $i = [1,...,8]$ are used.
Since a rapid change of the decay time acceptance at low decay times due to the turn-on effect generated by the lifetime and other selection cuts is expected, more knots are placed in that regime.
At higher decay times we expect linear behavior, with a possible small effect due to the VELO reconstruction. Therefore fewer knots are used. 
Furthermore, $v_{7}$ is fixed to 1 in order to normalize the overall acceptance function. To stabilise the last spline, $v_{8}$ is fixed by a linear extrapolation from the two previous splines:

\begin{equation}   
v_{N} = v_{N-1} + \frac{v_{N-2} - v_{N-1}}{t_{N-2} - t_{N-1}} \cdot (t_{N} - t_{N-1}).
\label{eq:SplineExtra}
\end{equation}

Here, $N=8$ and $t_{N-1}$ corresponds to the knot position associated with $v_{N-1}$. 

\clearpage

\subsubsection{Comparison of acceptance in subsamples}
\label{subsec: AccComparison}

It is possible that the decay-time dependent efficiency deviates in different subsamples of our data. 
In particular, the acceptance could differentiate in subsamples with different final state kinematics, such as the run I \& run II sample, the various $\Ds$ final states and the ways an event is triggered at the L0 stage.
To investigate possible deviations, the full selected $\Bs\to\Ds\pion\pion\pion$ sample is split into subsamples according to the categories mentioned above (run, $\Ds$ state, L0 trigger). 
For each subsample, the fit procedure described at the beginning of this chapter, using the pdf given by Eq. \ref{eq:AccPDF}, is repeated and the obtained values for the spline coefficients  $v_{i}$ are compared.
Figure \ref{fig:AccCompDs} shows the comparison of the obtained spline coefficients for the different $\Ds$ final states.

\begin{figure}[h]
\includegraphics[height=!,width=\textwidth]{figs/Acceptance/adaptive_N4/timeAcc_combined_by_DsFinalState.pdf}
\caption{Comparison of the spline coefficients obtained from time-dependent fits to the $\Bs\to\Ds\pion\pion\pion$ subsamples of different $\Ds$ final states. 
The comparison of one particular $\Ds$ state against all other states is shown.}
\label{fig:AccCompDs}
\end{figure}
\begin{figure}[h]
\includegraphics[height=6.5cm,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAcc_combined_by_run.pdf}
\includegraphics[height=6.5cm,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAcc_combined_by_trigger.pdf}
\caption{Comparison of the spline coefficients obtained from time-dependent fits to the $\Bs\to\Ds\pion\pion\pion$ subsamples of (left) the different runs and (right) L0 trigger categories.}
\label{fig:AccCompRunTrig}
\end{figure}

Investigating the obtained spline coefficients from different $\Ds$ final states, 
good agreement is observed between all four channels and no need to distinguish between different final states in the time-dependent amplitude fit is found. \newline
The comparison between spline coefficients for the different runs and L0 trigger categories is shown in Figure \ref{fig:AccCompRunTrig}.

Significant deviations between spline coefficients obtained from the two different runs and L0 trigger categories can be observed. 
The deviations are most pronounced in the $(0-5) \ps$ region, where the majority of statistics is found. 
Therefore, the time-dependent efficiency has to be treated separately for the runs and L0 categories. 
This is achieved by implementing a simultaneous fit, where the acceptance description is allowed to vary in the subsamples.   

\clearpage
\subsubsection{Results}

The nominal fit to $\Bs\to\Ds\pion\pion\pion$ data using this configuration is shown in Figure \ref{fig:accFit}. 
Note that the normalization of the splines in the following figures is not in scale.
The fit parameters obtained from the described fits to data and simulation are summarised in Table \ref{table:splines}.

\begin{figure}[h]
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_norm_combined.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_norm_mc_combined.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_signal_B0_combined.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_signal_mc_combined.pdf}
\caption{The red line shows the spline function describing the acceptance and the blue line depicts the total fit function.}
\label{fig:accFit}
\end{figure}

\input{tables/Acceptance/adaptive_N4/splineCoeffs_combined.tex}

\clearpage

\input{tables/Acceptance/adaptive_N4/splineCoeffs_Run1_t0.tex}
\input{tables/Acceptance/adaptive_N4/splineCoeffs_Run1_t1.tex}
\input{tables/Acceptance/adaptive_N4/splineCoeffs_Run2_t0.tex}
\input{tables/Acceptance/adaptive_N4/splineCoeffs_Run2_t1.tex}

\clearpage

\begin{figure}[h]
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_norm_Run1_t0.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_norm_mc_Run1_t0.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_signal_B0_Run1_t0.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_signal_mc_Run1_t0.pdf}
\caption{}
\label{fig:}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_norm_Run1_t1.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_norm_mc_Run1_t1.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_signal_B0_Run1_t1.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_signal_mc_Run1_t1.pdf}
\caption{}
\label{fig:}
\end{figure}

\clearpage

\begin{figure}[h]
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_norm_Run2_t0.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_norm_mc_Run2_t0.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_signal_B0_Run2_t0.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_signal_mc_Run2_t0.pdf}
\caption{}
\label{fig:}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_norm_Run2_t1.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_norm_mc_Run2_t1.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_signal_B0_Run2_t1.pdf}
\includegraphics[height=!,width=0.49\textwidth]{figs/Acceptance/adaptive_N4/timeAccRatioFit_signal_mc_Run2_t1.pdf}
\caption{}
\label{fig:}
\end{figure}


\subsection{Phasespace acceptance}
\label{sec:phasespaceAcceptance}
